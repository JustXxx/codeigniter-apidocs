<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>API Documentation</title>

	<!-- Style -->
	<link href='http://fonts.googleapis.com/earlyaccess/nanumgothic.css' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
	<!-- Test CSS Code -->
	<link rel="stylesheet/less" href="<?= base_url(); ?>/assets/css/color.less">
	<link rel="stylesheet/less" href="<?= base_url(); ?>/assets/css/documentation.less">
	
	<!-- jQuery -->
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

	<!-- Test Javascript Code -->
	<!-- <script src="<?= base_url(); ?>/assets/js/index.js"></script> -->

	<!-- Less -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js"></script>

	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<!-- underscope -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>

	<!-- jquery.slimscroll -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.6/jquery.slimscroll.min.js"></script>

	<!-- JS -->
	<script>
		var base_url = '<?= $base_url ?>'
		var menu_click_flag = false
		const SCROLL_Y_CONTROL = 50

		$(document).ready(function(){
			$(window).scroll(function(){
				if (menu_click_flag)
					return false

				var _window = $(this)
				var window_scroll_top = _window.scrollTop()

				if (window_scroll_top + _window.height() == $(document).height()) {
			    	$('li.highlight ol .highlight').removeClass('highlight')
			    	$('li.highlight ol li').last().addClass('highlight')
			    }
			    else {
			    	$('div.api-wrap').each(function(index, method_dom){
			    		var _method_dom = $(method_dom)
			    		var method_dom_top = _method_dom.offset().top
			    		
			    		if (window_scroll_top <= method_dom_top + _method_dom.height() / 2){
			    			$('li.highlight ol .highlight').removeClass('highlight')
			    			$('li.highlight ol li').each(function(index, li_dom){
			    				if (_method_dom.find('h2.method-name').text() == $(li_dom).find('a').text()){
			    					$(li_dom).addClass('highlight')
			    					return false
			    				}
			    			})
			    			return false
			    		}
			    	})
			    }
			})

			$('ol li').click(function(event){
				event.preventDefault()
				menu_click_flag = true

				var _this = $(this);
				$('html, body').stop(true).animate({
					scrollTop: $('.' + _this.text()).offset().top - SCROLL_Y_CONTROL
				}, 500, function() { menu_click_flag = false });

				$('li.highlight ol .highlight').removeClass('highlight')
				_this.addClass('highlight')
			})

			$('li.collection label a').click(function(){
				location.href = base_url + 'docs/view/' + $(this).text()
			})

			$(document).on('keyup', '.api-box .urlparameter input[type="text"]', function(){
				var _this = $(this)
				var input_index = _this.parents('.urlparameter').find('input[type="text"]').index(_this)
				var url_val = _this.parents('.group').siblings('.endpoint')
				var method_name = _this.parents('.api-box').siblings('.method-name').text()

				var split_url = url_val.text().split(method_name + '/')
				split_url[0] += method_name
				split_url[1].split('/').forEach(function(element, index){
					split_url[0] += '/' + (index == input_index ? (_this.val() != '' ? _this.val() : _this.parent().siblings('div').text()) : element)
				})

				url_val.text(split_url[0])
			})

			$(document).on('click', 'button[type="submit"]', function(){
				var api_parent = $(this).parents('section')
				var call_type = api_parent.find('.method').attr('data-method')

				var ajax_config = {
					type: call_type,
					url: function(){
						var url = api_parent.find('.endpoint').text().replace(/\s/g, '')

						if (call_type == 'GET'){
							$.each(api_parent.children('.parameter').children('.row'), function(index, row_val){
								$.each($(row_val).children('div'), function(div_index, div_val){
									var input_dom = $(div_val).children('input[type="text"]')
									var parameter_val = input_dom.val()
									if (parameter_val != undefined){
										url += (index ? '&' : '?') + input_dom.parent().siblings('div').text() + '=' + parameter_val
									}
								})
							})
						}

						return url
					}(),

					data: call_type != 'GET' ? ajax_data_binding(api_parent, 'parameter') : null,
					headers: ajax_data_binding(api_parent, 'header')
				}

				ajax_config['success'] = function(data, a, request){
					var request_data_str = '# ' + call_type + ' ' + ajax_config['url'] + '\n'

					for (parameter_key in ajax_config['data']){
						request_data_str += '? ' + parameter_key + '=' + ajax_config['data'][parameter_key] + '\n'
					}
					request_data_str += '\n'

					for (header_key in ajax_config['headers']){
						request_data_str += '+ ' + header_key + ':' + ajax_config['headers'][header_key] + '\n'
					}
					
					var request_code_wrap = $('.request pre.code-wrap')
					var response_code_wrap = $('.response pre.code-wrap')
					request_code_wrap.text(request_data_str)
					request_code_wrap.removeClass('highlighter')
					response_code_wrap.text(data)
					response_code_wrap.removeClass('highlighter')

					parse_code_block()
					$('body').addClass('console-active')
				}
				
				$.ajax(ajax_config)
			})

			$('.footer-header-area').click(function(){
				$('body').removeClass('console-active')
			})
		})

		function ajax_data_binding(api_parent, group_name){
			var data_str = {}
			$.each(api_parent.find('.' + group_name).children('.row'), function(index, row){
				var row_div = $(row).children('div')
				data_str[row_div.eq(0).text()] = row_div.eq(1).children('input[type="text"]').val()
			})
			return data_str
		}

		function parse_code_block(){
			function formatXml(xml) {
				var formatted = '';
				var reg = /(>)[\s]*(<)(\/*)/g;
				xml = xml.replace(reg, '$1\r\n$2$3');
				var pad = 0;
				jQuery.each(xml.split('\r\n'), function(index, node) {
					var indent = 0;
					if (node.match( /.+<\/\w[^>]*>$/ )) {
						indent = 0;
					} else if (node.match( /^<\/\w/ )) {
						if (pad != 0) pad -= 1;
					} else if (node.match( /^<\w[^>]*[^\/]>.*$/ )) {
						indent = 1;
					} else {
						indent = 0;
					}

					var padding = '';
					for (var i = 0; i < pad; i++) {
						padding += '    ';
					}

					formatted += padding + node + '\r\n';
					pad += indent;
				});

				return formatted;
			}
			$("pre.code-wrap").each(function(){
				if ($(this).hasClass("highlighter"))
					return;

				var data = $(this).html();

				data = _.unescape(data).trim();

				// cross-hatch
				var crosshatch = /^(#[\s]+)(GET|POST|DELETE|UPDATE)([\s]{1,})([\S]+)([\s]*HTTP\/[\d.]+){0,1}/gm;
				data = data.replace(crosshatch, "<span class='cross-hatch'>$1$2</span>$3<span class='url'>$4</span><span class='cross-hatch'>$5</span>");

				// spacial-charactor
				var spacialcharactor = /^(\?)([\s]{1,})([\S]+=)([\S]+){0,}$/gm;
				data = data.replace(spacialcharactor, "<span class='spacial-charactor'>$1</span>$2<span class='parameter-key'>$3</span><span class='parameter-value'>$4</span>");

				// header
				var header = /^(\+)([\s]{1,})([\S]+:)[\s]{0,}([\S]+)$/gm;
				data = data.replace(header, "<span class='spacial-charactor'>$1</span>$2<span class='header-key'>$3</span><span class='header-value'>$4</span>");

				// Query Param
				var newlength = 0;
				var queryParam = /(((&){0,1}[\w]+=)([\w]+))/gm;
				while ((m = queryParam.exec(data)) !== null) {
					if (m.index === queryParam.lastIndex)
						queryParam.lastIndex ++;
					newlength += m[1].length;
				}

				if (data.length == newlength) {
					$(".response .description").html("query response");

					data = data.replace(queryParam, "<span class='query-key'>$2</span><span class='query-value'>$4</span>");

				// JSON
				} else if (data.indexOf("\<\?xml") === -1 && data.indexOf("\<\? xml") === -1) {
					try {
						odata = data;
						data = JSON.stringify(JSON.parse(data), null, 4);

						$(".response .description").html("json response");

						// brackets
						var brackets = /({|}|\(|\)|\[|\])/gm;
						data = data.replace(brackets, "<span class='brackets'>$1</span>");

						// numbers | strings
						var m;
						var lastindex = 0;
						var newdata = "";
						var numberstrings = /(("[ \t\S]*")|('[ \t\S]*')|([\d]+)){0,1}(:)([\s]{1,})((("[ \t\S]*")|('[ \t\S]*')|([\d]+|null))){0,1}/gm;
						while ((m = numberstrings.exec(data)) !== null) {
							if (m.index === numberstrings.lastIndex) {
						        numberstrings.lastIndex++;
						    }

						    newdata += data.substr(lastindex, m.index - lastindex);

							if (m[4])
								newdata += "<span class='number'>" + m[1] + m[5] + "</span>";
							else
								newdata += "<span class='string'>" + m[1] + m[5] + "</span>";

							newdata += m[6];

							if (m[7]) {
								if (m[11])
									newdata += "<span class='number'>" + m[8] + "</span>";
								else
									newdata += "<span class='string'>" + m[8] + "</span>";

								lastindex = m.index + m[0].length;
							} else {
								lastindex = m.index + m[0].length;
							}
						}
						data = newdata + data.substr(lastindex, data.length - lastindex)
						data = data.replace(/(,)/gm, "<span class='brackets'>$1</span>");
					} catch(e) {
						data = odata;
						$(".response .description").html("response");
					}

				// XML
				} else {
					data = formatXml(data);

					$(".response .description").html("xml response");

					var m;
					var lastindex = 0;
					var newdata = "";
					var xml = /(<)([\/|?]{0,})([^>\s]+)(([\s]+[^>\s]+)*)(>)/gm;
					while ((m = xml.exec(data)) !== null) {
						if (m.index === xml.lastIndex) {
							xml.lastIndex++;
						}

						newdata += "<span class='xml-content'>" + data.substr(lastindex, m.index - lastindex) + "</span>";

						if (m[2] === '?') {
							newdata += "<span class='xml-block'>" + _.escape(m[0]) + "</span>";
						} else {
							newdata += "<span class='xml-tag-block'>" + _.escape(m[1] + m[2] + m[3]) + "</span>" + m[4].replace(/([\w]+=)(('[\w]')|("[\w]+"))/g, "<span class='xml-field'>$1</span><span class='number'>$2</span>") + "<span class='xml-tag-block'>" + _.escape(m[6]) + "</span>";
						}

						lastindex = m.index + m[0].length;
					}
					data = newdata + "<span class='xml-content'>" + data.substr(lastindex, data.length - lastindex) + "</span>";
				}

				$(this).addClass("highlighter");
				$(this).html(data);
			});
		}
	</script>
</head>
<body>
	<aside class="sidebar-container">
		<div class="sidebar-brand-area">
			<img src="https://cdn.rawgit.com/myartame/codeigniter-apidocs/develop/assets/img/brand.png" alt="">
		</div>
		<div class="sidebar-menu-area">
			<div class="sidebar-menu-wrap">
				<ul>
					<?php $highlight_flag = true; ?>
					<?php foreach ($api_list as $controller_key => $api_value): ?>
						<li class="collection <?php if ($controller_key == $active_controller) echo 'highlight' ?>">
							<div class="block"></div>
							<label><a><?= $controller_key ?></a></label>
							<ol>
								<?php foreach ($api_value as $method_index => $api_method_name): ?>
									<li class="<?php if (!$method_index) echo 'highlight'; ?>"><a><?= $api_method_name; ?></a></li>
								<?php endforeach;?>
							</ol>
						</li>
					<?php endforeach;?>
				</ul>
			</div>
		</div>
	</aside>
	<div class="main-container">
		<div class="main-header-area">
			<h1><?= $active_controller ?></h1>
			<?php foreach ($api_detail as $api_item): ?>
				<div class="api-wrap <?= $api_item['method_name']; ?>">
					<h2 class="method-name"><?= $api_item['method_name']; ?></h2>
					<?php if ($api_item['description'] != '') { ?>
					<blockquote>
						<?= $api_item['description']; ?>
					</blockquote>
					<?php } ?>
					<section class="api-box">
						<div class="method" data-method="<?= $api_item['call_type'] ?>"></div>
						<div class="endpoint">
							<?php $url_parameter_str = ''; foreach($api_item['url_parameter'] as $url_parameter_item) $url_parameter_str .= '/{' . $url_parameter_item . '}'; ?>
							<?php $api_url = $base_url . strtolower($active_controller) . ($api_item['method_name'] == 'index' ? '' : ($api_item['method_name'] == 'index' ? '' : '/' . $api_item['method_name']) . ($url_parameter_str != '/' ? $url_parameter_str : ''));?>
							<a href="<?= $api_url; ?>" target="_blank"><?= $api_url; ?></a>
						</div>
						<?php if ($api_item['method_name'] != 'index'){ ?>
							<?php if (count($api_item['url_parameter'])) { ?>
								<div class="urlparameter group">
									<label>URL Parameter</label>
									<?php foreach($api_item['url_parameter'] as $url_parameter_item): ?>
										<div class="row">
											<div class="col-lg-3"><p class="ico-circle-none"></p><?= '{' . $url_parameter_item . '}' ?></div>
											<div class="col-lg-9">
												<input type="text" value="" />
											</div>
										</div>
									<?php endforeach; ?>
								</div>
							<?php } ?>
							<?php if (count($api_item['header'])) { ?>
								<div class="header group">
									<label>Header</label>
									<?php foreach($api_item['header'] as $header_item): ?>
										<div class="row">
											<div class="col-lg-3"><p class="ico-circle-none"></p><?= $header_item ?></div>
											<div class="col-lg-9">
												<input type="text" value="" />
											</div>
										</div>
									<?php endforeach; ?>
								</div>
							<?php } ?>
							<?php if (count($api_item['parameter'])) { ?>
								<div class="parameter group">
									<label>Parameter</label>
									<?php foreach($api_item['parameter'] as $parameter_item): ?>
										<div class="row">
											<div class="col-lg-3"><p class="ico-circle"></p><?= $parameter_item ?></div>
											<div class="col-lg-9">
												<input type="text" value="" />
											</div>
										</div>
									<?php endforeach; ?>
								</div>
							<?php } ?>
						<?php } ?>
						<div class="tryit row">
							<div class="col-lg-12">
								<button type="submit">
									Try it
								</button>
							</div>
						</div>
					</section>
				</div>
			<?php endforeach; ?>
		</div>
	</div>

	<footer class="footer-container">
		<div class="footer-header-area">
			<label>Request Console</label>
			<a href="#">
				<p class="ico-close"></p>
			</a>
		</div>
		<div class="footer-content-area row">
			<div class="code-area request col-md-6">
				<div class="description">api request</div>
				<pre class="code-wrap">
				</pre>
			</div>
			<div class="code-area response col-md-6">
				<div class="description">response</div>
				<pre class="code-wrap">
				</pre>
			</div>
		</div>
	</footer>

	<script type="text/javascript">
		$(function() {
			$('.sidebar-menu-wrap').slimScroll({
		        height: '100%'
		    });
		    $('.code-wrap').slimScroll({
		    	height: '226px'
		    });

		    parse_code_block();
		});
	</script>
</body>
</html>